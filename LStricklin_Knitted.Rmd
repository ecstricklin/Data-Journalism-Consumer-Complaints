---
title: "LStricklin_Flexdashboard"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
---

```{r setup, include=FALSE}
library(flexdashboard)
library(tidyverse)
library(plotly)
library(tigris)
library(tmap)
library(tmaptools)
complaints <- readRDS("~/github_stricklin/Data-Journalism-Consumer-Complaints/complaints.rds")
```

Column {data-width=650}
-----------------------------------------------------------------------

### Customer complaints have increased on an upward trend over the past year.

```{r}



complaints2 <- complaints %>%
  count(date_received)

fig <- plot_ly(complaints2, x = ~date_received, y = ~n, type = 'scatter', mode = 'lines')
fig %>% layout(title = 'Number of Customer Complaints per Day', yaxis=list(title = 'Date Received'), xaxis = list(title='Number of Complaints'))
fig

```

Column {data-width=350}
-----------------------------------------------------------------------

### Chart B

```{r}

complaints3 <- complaints %>%
  count(state)
complaints3 <- complaints3 %>% filter(n > 8056)

fig2 <- complaints3 %>% plot_ly(labels = ~state, values = ~n)
fig2 <- fig2 %>% add_pie(hole = 0.6)
fig2 <- fig2 %>% layout(title = 'title', showlegend = F, xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE), yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))
fig2

#making a map instead





```

### Chart C

```{r}

states <- tigris::states(cb=T)
complaints3 <- complaints %>%
  count(state)
complaints3_joined <- geo_join(states, complaints3, "STUSPS", "state")

us_state_names <- unique(fips_codes$state_name)[1:51]

complaints3_joined <- complaints3_joined %>% 
  filter(NAME %in% us_state_names)

mypalette <- colorNumeric("YlOrRd", domain = complaints3_joined$n)

popup_fcc <- paste0("Consumer Complaints Mar-Dec 2020: ", as.character(complaints3_joined$n))

leaflet(complaints3_joined) %>% 
  addTiles() %>% 
    setView(-98.483330, 38.712046, zoom = 4) %>% 
      addPolygons(data = states, fillColor = ~mypalette(complaints3_joined$n), fillOpacity = 0.9, weight = 0.2, smoothFactor = 0.2, label = popup_fcc) %>% 
        addLegend(pal=mypalette, values=complaints3_joined$n, bins=5, position="bottomright", title="Consumer Complaints Mar-Dec 2020", labFormat=labelFormat(digits=0))

```

